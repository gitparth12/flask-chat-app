<!DOCTYPE html>
<html lang="en">

<head>
    <title>Sign up</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
    <style>
        .signup-box {
            margin: 0;
            position: absolute;
            top: 30%;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <nav>
                <ul>
                    {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('chats') }}">My chats</a></li>
                    {% endif %}
                    <li><a href="{{ url_for('home') }}">Home</a></li>
                    <li><a href="{{ url_for('signup') }}">Sign up</a></li>
                    {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('logout') }}">Logout</a></li>
                    {% else %}
                    <li><a href="{{ url_for('login') }}">Login</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>
    <h3>{{ message }}</h3>
    <div class="signup-box">
        <main>
            <h2>Create an Account</h2>
            <form id="message_input_form" method="post" role="form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" name="username" id="username_input">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" name="password" id="password_input">
                </div>
                <button type="submit">Sign Up</button>
            </form>
        </main>
    </div>
</body>
<script>
    const socket = io.connect("http://127.0.0.1:5000");

    socket.on('connect', function () {

        document.getElementById('message_input_form').onsubmit = function (e) {
            e.preventDefault();

            let username = document.getElementById('username_input').value;
            let password = document.getElementById('password_input').value;
            alert(username);

            var chatKey = CryptoJS.lib.WordArray.random(16).toString();
            var encrypted_chatKey = CryptoJS.AES.encrypt(chatKey, password).toString();
            alert(encrypted_chatKey);
            if (username.length) {
                socket.emit('signup', {
                    username: username,
                    message: message
                })
            }
            message_input.value = '';
            message_input.focus();
        }
    });

    socket.on('status', function(status) {
        alert(status);
        if (status === 'success') {
            {{ url_for('login') }};
        }
    }
</script>

</html>
